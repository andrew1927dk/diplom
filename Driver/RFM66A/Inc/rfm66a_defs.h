/**
 * @file rfm66a_defs.h
 * @brief RFM driver
 * @version 0.1
 * @date 2022-12-22
 *
 *  (c) 2022
 */

#ifndef RFM66A_DEFS_H
#define RFM66A_DEFS_H

typedef struct {
    uint8_t cmd;
    uint8_t group;
    uint8_t num_byte;
    uint8_t offset;
    uint8_t arg[12];
} rfm_sp_cmd_t;

typedef struct {
    uint8_t cmd;
    uint8_t channel;
    uint8_t condition;
    uint8_t LenMsb;
    uint8_t LenLsb;
    uint8_t TxD_RxTO;   /* TX_DELAY | RXTIMEOUT_STATE */
    uint8_t TxRep_RxVS; /* TX_NUM_REPEAT | RXVALID_STATE */
    uint8_t RxIVs;      /* TX - nop | RXINVALID_STATE */
} rfm_tx_rx_t;

typedef struct {
    uint32_t f_xtal;
    uint8_t  outdiv;
    uint8_t  n_presc;
    uint8_t  payloadLen;
    uint8_t  variablePkt : 1;
} _rfm_gen_conf_t;

typedef enum {
    rfm_Read,
    rfm_Write
} rfm_spi_rw_t;

/* BOOT_COMMANDS */
#define POWER_UP (0x02)

/* COMMON_COMMANDS */
#define NOP                  (0x00)
#define PART_INFO            (0x01)
#define FUNC_INFO            (0x10)
#define SET_PROPERTY         (0x11)
#define GET_PROPERTY         (0x12)
#define GPIO_PIN_CFG         (0x13)
#define FIFO_INFO            (0x15)
#define GET_INT_STATUS       (0x20)
#define REQUEST_DEVICE_STATE (0x33)
#define CHANGE_STATE         (0x34)
#define READ_CMD_BUFF        (0x44)
#define READ_FRR_A           (0x50)
#define READ_FRR_B           (0x51)
#define READ_FRR_C           (0x53)
#define READ_FRR_D           (0x57)

/* IR_CAL_COMMANDS */
#define IRCAL        (0x17)
#define IRCAL_MANUAL (0x1a)

/* TX_COMMANDS */
#define START_TX      (0x31)
#define TX_HOP        (0x37)
#define WRITE_TX_FIFO (0x66)

/* RX_COMMANDS */
#define PACKET_INFO      (0x16)
#define GET_MODEM_STATUS (0x22)
#define START_RX         (0x32)
#define RX_HOP           (0x36)
#define READ_RX_FIFO     (0x77)

/* ADVANCED_COMMANDS */
#define GET_ADC_READING (0x14)
#define GET_PH_STATUS   (0x21)
#define GET_CHIP_STATUS (0x23)

#define PROP_GROUP_GLOBAL       (0x00) /* Property group global                  */
#define PROP_GROUP_INT          (0x01) /* Property group interrupts              */
#define PROP_GROUP_FRR          (0x02) /* Property group fast response registers */
#define PROP_GROUP_PREAMBLE     (0x10) /* Property group preamble                */
#define PROP_GROUP_SYNC         (0x11) /* Property group sync                    */
#define PROP_GROUP_PKT          (0x12) /* Property group packet config           */
#define PROP_GROUP_MODEM        (0x20) /* Property group modem                   */
#define PROP_GROUP_MODEM_CHFLT  (0x21) /* Property group RX coefficients         */
#define PROP_GROUP_PA           (0x22) /* Property group power amp               */
#define PROP_GROUP_SYNTH        (0x23) /* Property group synthesizer             */
#define PROP_GROUP_MATCH        (0x30) /* Property group address match           */
#define PROP_GROUP_FREQ_CONTROL (0x40) /* Property group frequency control       */
#define PROP_GROUP_RX_HOP       (0x50) /* Property group RX hop                  */
#define PROP_GROUP_PTI          (0xF0) /* Property group packet trace interface  */

/* clang-format off */

#define SI446X_PATCH_CMDS                   \
0x08,0x04,0x21,0x71,0x4B,0x00,0x00,0xDC,0x95, \
0x08,0x05,0xA6,0x22,0x21,0xF0,0x41,0x5B,0x26, \
0x08,0xE2,0x2F,0x1C,0xBB,0x0A,0xA8,0x94,0x28, \
0x08,0x05,0x87,0x67,0xE2,0x58,0x1A,0x07,0x5B, \
0x08,0xE1,0xD0,0x72,0xD8,0x8A,0xB8,0x5B,0x7D, \
0x08,0x05,0x11,0xEC,0x9E,0x28,0x23,0x1B,0x6D, \
0x08,0xE2,0x4F,0x8A,0xB2,0xA9,0x29,0x14,0x13, \
0x08,0x05,0xD1,0x2E,0x71,0x6A,0x51,0x4C,0x2C, \
0x08,0xE5,0x80,0x27,0x42,0xA4,0x69,0xB0,0x7F, \
0x08,0x05,0xAA,0x81,0x2A,0xBD,0x45,0xE8,0xA8, \
0x08,0xEA,0xE4,0xF0,0x24,0xC9,0x9F,0xCC,0x3C, \
0x08,0x05,0x08,0xF5,0x05,0x04,0x27,0x62,0x98, \
0x08,0xEA,0x6B,0x62,0x84,0xA1,0xF9,0x4A,0xE2, \
0x08,0x05,0xE9,0x77,0x05,0x4F,0x84,0xEE,0x35, \
0x08,0xE2,0x43,0xC3,0x8D,0xFB,0xAD,0x54,0x25, \
0x08,0x05,0x14,0x06,0x5E,0x39,0x36,0x2F,0x45, \
0x08,0xEA,0x0C,0x1C,0x74,0xD0,0x11,0xFC,0x32, \
0x08,0x05,0xDA,0x38,0xBA,0x0E,0x3C,0xE7,0x8B, \
0x08,0xEA,0xB0,0x09,0xE6,0xFF,0x94,0xBB,0xA9, \
0x08,0x05,0xD7,0x11,0x29,0xFE,0xDC,0x71,0xD5, \
0x08,0xEA,0x7F,0x83,0xA7,0x60,0x90,0x62,0x18, \
0x08,0x05,0x84,0x7F,0x6A,0xD1,0x91,0xC6,0x52, \
0x08,0xEA,0x2A,0xD8,0x7B,0x8E,0x4A,0x9F,0x91, \
0x08,0x05,0xBD,0xAA,0x9D,0x16,0x18,0x06,0x15, \
0x08,0xE2,0x55,0xAD,0x2D,0x0A,0x14,0x1F,0x5D, \
0x08,0x05,0xD3,0xE0,0x7C,0x39,0xCF,0x01,0xF0, \
0x08,0xEF,0x3A,0x91,0x72,0x6A,0x03,0xBB,0x96, \
0x08,0xE7,0x83,0x6D,0xA4,0x92,0xFC,0x13,0xA7, \
0x08,0xEF,0xF8,0xFD,0xCF,0x62,0x07,0x6F,0x1E, \
0x08,0xE7,0x4C,0xEA,0x4A,0x75,0x4F,0xD6,0xCF, \
0x08,0xE2,0xF6,0x11,0xE4,0x26,0x0D,0x4D,0xC6, \
0x08,0x05,0xFB,0xBF,0xE8,0x07,0x89,0xC3,0x51, \
0x08,0xEF,0x82,0x27,0x04,0x3F,0x96,0xA8,0x58, \
0x08,0xE7,0x41,0x29,0x3C,0x75,0x2A,0x03,0x1C, \
0x08,0xEF,0xAF,0x59,0x98,0x36,0xAA,0x0F,0x06, \
0x08,0xE6,0xF6,0x93,0x41,0x2D,0xEC,0x0E,0x99, \
0x08,0x05,0x29,0x19,0x90,0xE5,0xAA,0x36,0x40, \
0x08,0xE7,0xFB,0x68,0x10,0x7D,0x77,0x5D,0xC0, \
0x08,0xE7,0xCB,0xB4,0xDD,0xCE,0x90,0x54,0xBE, \
0x08,0xE7,0x72,0x8A,0xD6,0x02,0xF4,0xDD,0xCC, \
0x08,0xE7,0x6A,0x21,0x0B,0x02,0x86,0xEC,0x15, \
0x08,0xE7,0x7B,0x7C,0x3D,0x6B,0x81,0x03,0xD0, \
0x08,0xEF,0x7D,0x61,0x36,0x94,0x7C,0xA0,0xDF, \
0x08,0xEF,0xCC,0x85,0x3B,0xDA,0xE0,0x5C,0x1C, \
0x08,0xE7,0xE3,0x75,0xBB,0x39,0x22,0x4B,0xA8, \
0x08,0xEF,0xF9,0xCE,0xE0,0x5E,0xEB,0x1D,0xCB, \
0x08,0xE7,0xBD,0xE2,0x70,0xD5,0xAB,0x4E,0x3F, \
0x08,0xE7,0xB7,0x8D,0x20,0x68,0x6B,0x09,0x52, \
0x08,0xEF,0xA1,0x1B,0x90,0xCD,0x98,0x00,0x63, \
0x08,0xEF,0x54,0x67,0x5D,0x9C,0x11,0xFC,0x45, \
0x08,0xE7,0xD4,0x9B,0xC8,0x97,0xBE,0x8A,0x07, \
0x08,0xEF,0x52,0x8D,0x90,0x63,0x73,0xD5,0x2A, \
0x08,0xEF,0x03,0xBC,0x6E,0x1C,0x76,0xBE,0x4A, \
0x08,0xE7,0xC2,0xED,0x67,0xBA,0x5E,0x66,0x21, \
0x08,0xEF,0xE7,0x3F,0x87,0xBE,0xE0,0x7A,0x6D, \
0x08,0xE7,0xC9,0x70,0x93,0x1D,0x64,0xF5,0x6C, \
0x08,0xEF,0xF5,0x28,0x08,0x34,0xB3,0xB6,0x2C, \
0x08,0xEF,0x3A,0x0A,0xEC,0x0F,0xDB,0x56,0xCA, \
0x08,0xEF,0x39,0xA0,0x6E,0xED,0x79,0xD0,0x24, \
0x08,0xE7,0x6C,0x0B,0xAF,0xA9,0x4E,0x40,0xB5, \
0x08,0xE9,0xB9,0xAF,0xBF,0x25,0x50,0xD1,0x37, \
0x08,0x05,0x9E,0xDB,0xDE,0x3F,0x94,0xE9,0x6B, \
0x08,0xEC,0xC5,0x05,0xAA,0x57,0xDC,0x8A,0x5E, \
0x08,0x05,0x70,0xDA,0x84,0x84,0xDD,0xCA,0x90

#define RF_POWER_UP                            0x02, 0x81, 0x01, 0x01, 0xC9, 0xC3, 0x80
#define RF_CHANGE_STATE                        0x34, 0x02
#define RF_GPIO_PIN_CFG                        0x13, 0x21, 0x20, 0x00, 0x00, 0x48, 0x00, 0x00
#define RF_GLOBAL_XO_TUNE_2                    0x11, 0x00, 0x02, 0x00, 0x52, 0x00
#define RF_GLOBAL_CONFIG_1                     0x11, 0x00, 0x01, 0x03, 0x20
#define RF_INT_CTL_ENABLE_1                    0x11, 0x01, 0x01, 0x00, 0x00
#define RF_FRR_CTL_A_MODE_4                    0x11, 0x02, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00
#define RF_PREAMBLE_TX_LENGTH_9                0x11, 0x10, 0x09, 0x00, 0x08, 0x14, 0x00, 0x0F, 0x31, 0x00, 0x00, 0x00, 0x00
#define RF_SYNC_CONFIG_6                       0x11, 0x11, 0x06, 0x00, 0x01, 0xB4, 0x2B, 0x00, 0x00, 0x00
#define RF_PKT_CRC_CONFIG_12                   0x11, 0x12, 0x0C, 0x00, 0x04, 0x05, 0x08, 0xFF, 0xFF, 0x20, 0x02, 0x00, 0x00, 0x00, 0x00, 0x30
#define RF_PKT_FIELD_3_CRC_CONFIG_12           0x11, 0x12, 0x0C, 0x18, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
#define RF_PKT_RX_THRESHOLD_12                 0x11, 0x12, 0x0C, 0x0C, 0x12, 0x00, 0x01, 0x04, 0x00, 0x1F, 0xFF, 0x00, 0xA2, 0x00, 0x00, 0x00
#define RF_PKT_RX_FIELD_1_CRC_CONFIG_12        0x11, 0x12, 0x0C, 0x24, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
#define RF_PKT_RX_FIELD_4_CRC_CONFIG_5         0x11, 0x12, 0x05, 0x30, 0x00, 0x00, 0x00, 0x00, 0x00
#define RF_PKT_CRC_SEED_31_24_4                0x11, 0x12, 0x04, 0x36, 0x00, 0x00, 0x00, 0x00
#define RF_MODEM_MOD_TYPE_12                   0x11, 0x20, 0x0C, 0x00, 0x03, 0x00, 0x07, 0x0B, 0xB8, 0x00, 0x05, 0xC9, 0xC3, 0x80, 0x00, 0x04
#define RF_MODEM_FREQ_DEV_0_1                  0x11, 0x20, 0x01, 0x0C, 0x19
#define RF_MODEM_TX_RAMP_DELAY_12              0x11, 0x20, 0x0C, 0x18, 0x01, 0x80, 0x08, 0x03, 0xC0, 0x00, 0x10, 0x10, 0x00, 0xE8, 0x01, 0x04
#define RF_MODEM_BCR_NCO_OFFSET_2_12           0x11, 0x20, 0x0C, 0x24, 0x01, 0xF7, 0x51, 0x00, 0xFC, 0x02, 0xC2, 0x00, 0x04, 0x23, 0x80, 0x1C
#define RF_MODEM_AFC_LIMITER_1_3               0x11, 0x20, 0x03, 0x30, 0x0F, 0x28, 0x80
#define RF_MODEM_AGC_CONTROL_1                 0x11, 0x20, 0x01, 0x35, 0xE0
#define RF_MODEM_AGC_WINDOW_SIZE_12            0x11, 0x20, 0x0C, 0x38, 0x11, 0x39, 0x39, 0x80, 0x1A, 0xC8, 0x00, 0x00, 0x2A, 0x0C, 0xA4, 0x22
#define RF_MODEM_RAW_CONTROL_10                0x11, 0x20, 0x0A, 0x45, 0x83, 0x00, 0xF9, 0x01, 0x00, 0xFF, 0x06, 0x00, 0x18, 0x40
#define RF_MODEM_RAW_SEARCH2_2                 0x11, 0x20, 0x02, 0x50, 0x84, 0x08
#define RF_MODEM_SPIKE_DET_2                   0x11, 0x20, 0x02, 0x54, 0x03, 0x07
#define RF_MODEM_RSSI_MUTE_1                   0x11, 0x20, 0x01, 0x57, 0x00
#define RF_MODEM_DSA_CTRL1_5                   0x11, 0x20, 0x05, 0x5B, 0x40, 0x04, 0x08, 0x78, 0x20
#define RF_MODEM_CHFLT_RX1_CHFLT_COE13_7_0_12  0x11, 0x21, 0x0C, 0x00, 0xFF, 0xBA, 0x0F, 0x51, 0xCF, 0xA9, 0xC9, 0xFC, 0x1B, 0x1E, 0x0F, 0x01
#define RF_MODEM_CHFLT_RX1_CHFLT_COE1_7_0_12   0x11, 0x21, 0x0C, 0x0C, 0xFC, 0xFD, 0x15, 0xFF, 0x00, 0x0F, 0xFF, 0xBA, 0x0F, 0x51, 0xCF, 0xA9
#define RF_MODEM_CHFLT_RX2_CHFLT_COE7_7_0_12   0x11, 0x21, 0x0C, 0x18, 0xC9, 0xFC, 0x1B, 0x1E, 0x0F, 0x01, 0xFC, 0xFD, 0x15, 0xFF, 0x00, 0x0F
#define RF_PA_MODE_4                           0x11, 0x22, 0x04, 0x00, 0x08, 0x7F, 0x00, 0x1D
#define RF_SYNTH_PFDCP_CPFF_7                  0x11, 0x23, 0x07, 0x00, 0x2C, 0x0E, 0x0B, 0x04, 0x0C, 0x73, 0x03
#define RF_MATCH_VALUE_1_12                    0x11, 0x30, 0x0C, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
#define RF_FREQ_CONTROL_INTE_8                 0x11, 0x40, 0x08, 0x00, 0x38, 0x0C, 0x88, 0x88, 0x22, 0x22, 0x20, 0xFF

#define RADIO_CONFIGURATION_DATA_ARRAY { \
        SI446X_PATCH_CMDS, \
        0x07, RF_POWER_UP, \
        0x08, RF_GPIO_PIN_CFG, \
        0x06, RF_GLOBAL_XO_TUNE_2, \
        0x05, RF_GLOBAL_CONFIG_1, \
        0x05, RF_INT_CTL_ENABLE_1, \
        0x08, RF_FRR_CTL_A_MODE_4, \
        0x0D, RF_PREAMBLE_TX_LENGTH_9, \
        0x0A, RF_SYNC_CONFIG_6, \
        0x10, RF_PKT_CRC_CONFIG_12, \
        0x10, RF_PKT_RX_THRESHOLD_12, \
        0x10, RF_PKT_FIELD_3_CRC_CONFIG_12, \
        0x10, RF_PKT_RX_FIELD_1_CRC_CONFIG_12, \
        0x09, RF_PKT_RX_FIELD_4_CRC_CONFIG_5, \
        0x08, RF_PKT_CRC_SEED_31_24_4, \
        0x10, RF_MODEM_MOD_TYPE_12, \
        0x05, RF_MODEM_FREQ_DEV_0_1, \
        0x10, RF_MODEM_TX_RAMP_DELAY_12, \
        0x10, RF_MODEM_BCR_NCO_OFFSET_2_12, \
        0x07, RF_MODEM_AFC_LIMITER_1_3, \
        0x05, RF_MODEM_AGC_CONTROL_1, \
        0x10, RF_MODEM_AGC_WINDOW_SIZE_12, \
        0x0E, RF_MODEM_RAW_CONTROL_10, \
        0x06, RF_MODEM_RAW_SEARCH2_2, \
        0x06, RF_MODEM_SPIKE_DET_2, \
        0x05, RF_MODEM_RSSI_MUTE_1, \
        0x09, RF_MODEM_DSA_CTRL1_5, \
        0x10, RF_MODEM_CHFLT_RX1_CHFLT_COE13_7_0_12, \
        0x10, RF_MODEM_CHFLT_RX1_CHFLT_COE1_7_0_12, \
        0x10, RF_MODEM_CHFLT_RX2_CHFLT_COE7_7_0_12, \
        0x08, RF_PA_MODE_4, \
        0x0B, RF_SYNTH_PFDCP_CPFF_7, \
        0x10, RF_MATCH_VALUE_1_12, \
        0x0C, RF_FREQ_CONTROL_INTE_8, \
        0x00 \
 }

/* clang-format on */

#endif    // RFM66A_DEFS_H
